<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hamza Assistance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-container, .admin-container {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .toggle-button {
            transition: background-color 0.3s ease;
        }
        .toggle-button.active {
            background-color: #f97316;
            color: white;
        }
        .card-enter {
            animation: card-enter 0.5s ease-out;
        }
        @keyframes card-enter {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Creative Orange Background */
        .creative-bg {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 25%, #ff8c42 50%, #ff6b35 75%, #f7931e 100%);
            position: relative;
        }
        
        .creative-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }
        
        .creative-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            animation: pattern 30s linear infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        @keyframes pattern {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(60px) translateY(60px); }
        }
        
        /* Floating elements */
        .floating-element {
            position: absolute;
            opacity: 0.1;
            animation: float-element 15s ease-in-out infinite;
        }
        
        .floating-element:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }
        
        .floating-element:nth-child(2) {
            top: 20%;
            right: 15%;
            animation-delay: 3s;
        }
        
        .floating-element:nth-child(3) {
            bottom: 15%;
            left: 20%;
            animation-delay: 6s;
        }
        
        .floating-element:nth-child(4) {
            bottom: 25%;
            right: 10%;
            animation-delay: 9s;
        }
        
        @keyframes float-element {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
            25% { transform: translateY(-30px) rotate(90deg) scale(1.1); }
            50% { transform: translateY(-15px) rotate(180deg) scale(0.9); }
            75% { transform: translateY(-45px) rotate(270deg) scale(1.05); }
        }
        
        /* Enhanced glass effect */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        /* Fix for select dropdowns */
        select {
            background-color: rgba(0, 0, 0, 0.8) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        select option {
            background-color: rgba(0, 0, 0, 0.9) !important;
            color: white !important;
        }
        
        select:focus {
            outline: none !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.2) !important;
        }
        
        /* Ensure Super Admin sections stay within container */
        #super-admin-view .glass-effect {
            position: relative;
            overflow: hidden;
        }
        
        #requests-section, #admin-section {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body class="creative-bg text-white overflow-x-hidden h-screen">

    <div id="app" class="flex flex-col min-h-screen relative">
        <!-- Floating decorative elements -->
        <div class="floating-element text-6xl">
            <i class="fas fa-car"></i>
        </div>
        <div class="floating-element text-4xl">
            <i class="fas fa-tools"></i>
        </div>
        <div class="floating-element text-5xl">
            <i class="fas fa-wrench"></i>
        </div>
        <div class="floating-element text-3xl">
            <i class="fas fa-cog"></i>
        </div>

        <!-- Header at the top -->
        <div class="text-center mb-6 mt-6 px-4">
            <h1 class="text-2xl sm:text-3xl md:text-5xl font-bold text-white mb-2 drop-shadow-lg flex flex-col sm:flex-row justify-center items-center gap-2">
                <i class="fas fa-car-burst text-3xl sm:text-5xl md:text-7xl mr-0 sm:mr-3 text-white"></i>
                <span>Hamza Assistance</span>
            </h1>
            <p class="text-base sm:text-lg text-white/90 drop-shadow-md">Your emergency lifeline on the road.</p>
        </div>

        <!-- Main Content -->
        <main class="relative z-10 flex-1">
            <div class="container mx-auto p-4 md:p-6">
                

                <!-- View Toggle -->
                <div class="flex justify-center mb-6 glass-effect rounded-full p-1 max-w-md mx-auto">
                    <button id="user-view-btn" class="toggle-button active w-1/3 py-2 rounded-full font-semibold">User</button>
                    <button id="admin-view-btn" class="toggle-button w-1/3 py-2 rounded-full font-semibold">Admin</button>
                    <button id="super-admin-btn" class="toggle-button w-1/3 py-2 rounded-full font-semibold">Super Admin</button>
                </div>

                <!-- User View -->
                <div id="user-view">
                    <div class="max-w-lg mx-auto glass-effect p-6 md:p-8 rounded-2xl shadow-2xl">
                        <h2 class="text-2xl font-bold text-center mb-6 text-white">Submit a Service Request</h2>
                        <form id="request-form" class="space-y-5">
                            <div>
                                <label for="userInfo" class="block text-sm font-medium text-white/90 mb-1">Full Name, Car Model, Phone Number, Location</label>
                                <textarea id="userInfo" name="userInfo" required rows="4" class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-2.5 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50 focus:border-white/50" placeholder="Paste your information here:&#10;Full Name: [Your Name]&#10;Car Model: [Your Car]&#10;Phone: [Your Phone]&#10;Location: [Your Location]"></textarea>
                            </div>
                            <div>
                                    <label class="block text-sm font-medium text-white/90 mb-1">Upload Photo</label>
                                <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-white/30 border-dashed rounded-lg bg-white/10">
                                    <div class="space-y-1 text-center">
                                        <i class="fas fa-camera-retro text-4xl text-white/60"></i>
                                        <div class="flex text-sm text-white/80">
                                            <label for="photo-upload" class="relative cursor-pointer bg-white/20 rounded-md font-medium text-white hover:bg-white/30 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-white/50 px-2">
                                                <span>Upload a file</span>
                                                <input id="photo-upload" name="photo-upload" type="file" class="sr-only" accept="image/*">
                                            </label>
                                            <p class="pl-1">or drag and drop</p>
                                        </div>
                                        <p id="file-name" class="text-xs text-white/60">PNG, JPG, GIF up to 10MB</p>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">
                                Send Request
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Admin View -->
                <div id="admin-view" class="hidden">
                     <div class="glass-effect p-4 md:p-6 rounded-2xl shadow-2xl">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Admin Dashboard</h2>
                        
                        <!-- Admin Tabs -->
                        <div class="flex justify-center mb-6">
                            <div class="flex bg-white/20 rounded-lg p-1">
                                <button id="admin-requests-tab" class="px-4 py-2 rounded-md text-white font-medium bg-white/30">Requests</button>
                                <button id="admin-contacts-tab" class="px-4 py-2 rounded-md text-white font-medium">Operators</button>
                            </div>
                        </div>

                        <!-- Admin Requests Management -->
                        <div id="admin-requests-section">
                            <h3 class="text-xl font-bold mb-4 text-white">Live Requests</h3>
                            <div id="admin-request-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Placeholder for requests -->
                                <div class="text-center text-white/60 col-span-full py-10">
                                    <i class="fas fa-spinner fa-spin text-3xl"></i>
                                    <p class="mt-2">Waiting for incoming requests...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Contacts Management -->
                        <div id="admin-contacts-section" class="hidden">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-white">Operator Management</h3>
                                <button id="admin-add-contact-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-plus mr-2"></i>Add Operator
                                </button>
                            </div>
                            <div id="admin-contacts-list" class="space-y-3">
                                <!-- Admin contacts will be populated here -->
                            </div>
                        </div>
                     </div>
                </div>

                <!-- Super Admin View -->
                <div id="super-admin-view" class="hidden">
                    <div class="glass-effect p-4 md:p-6 rounded-2xl shadow-2xl">
                        <h2 class="text-2xl font-bold mb-6 text-center text-white">Super Admin Dashboard</h2>
                        
                        <!-- Super Admin Tabs -->
                        <div class="flex justify-center mb-6">
                            <div class="flex bg-white/20 rounded-lg p-1">
                                <button id="contacts-tab" class="px-4 py-2 rounded-md text-white font-medium bg-white/30">Operators</button>
                                <!-- <button id="users-tab" class="px-4 py-2 rounded-md text-white font-medium">Users</button> -->
                                <button id="requests-tab" class="px-4 py-2 rounded-md text-white font-medium">Requests</button>
                                <button id="admin-tab" class="px-4 py-2 rounded-md text-white font-medium">Admin</button>
                            </div>
                        </div>

                        <!-- Contacts Management -->
                        <div id="contacts-section">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-white">Operator Management</h3>
                                <button id="add-contact-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-plus mr-2"></i>Add Operator
                                </button>
                            </div>
                            <div id="contacts-list" class="space-y-3">
                                <!-- Contacts will be populated here -->
                            </div>
                        </div>

                        

                        <!-- Requests Management -->
                        <div id="requests-section" class="hidden" style="display: none;">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-white">Request Management</h3>
                            </div>
                            <div id="super-admin-requests" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Requests will be populated here -->
                            </div>
                        </div>

                        <!-- Admin Management -->
                        <div id="admin-section" class="hidden" style="display: none;">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold text-white">Admin Management</h3>
                                <button id="add-admin-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-plus mr-2"></i>Add Admin
                                </button>
                            </div>
                            <div id="admin-list" class="space-y-3">
                                <!-- Admins will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer -->
        <footer class="relative z-20 glass-effect border-t border-white/20 mt-auto">
            <div class="container mx-auto px-4 md:px-8 py-8">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                    <!-- Company Info -->
                    <div class="md:col-span-2">
                        <div class="flex items-center space-x-3 mb-4">
                            <i class="fas fa-car-burst text-2xl text-white"></i>
                            <span class="text-xl font-bold text-white">Hamza Assistance</span>
                        </div>
                        <p class="text-white/80 mb-4 max-w-md">
                            Your trusted partner for emergency roadside assistance. We provide 24/7 support to get you back on the road safely and quickly.
                        </p>
                        <!-- <div class="flex space-x-4">
                            <a href="#" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors duration-200">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors duration-200">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors duration-200">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors duration-200">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors duration-200">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </div>
                    </div> -->
                    
                    <!-- Quick Links -->
                    <!-- <div>
                        <h3 class="text-lg font-semibold text-white mb-4">Quick Links</h3>
                        <ul class="space-y-2">
                            <li><a href="#home" class="text-white/80 hover:text-white transition-colors duration-200">Home</a></li>
                            <li><a href="#services" class="text-white/80 hover:text-white transition-colors duration-200">Services</a></li>
                            <li><a href="#about" class="text-white/80 hover:text-white transition-colors duration-200">About Us</a></li>
                            <li><a href="#contact" class="text-white/80 hover:text-white transition-colors duration-200">Contact</a></li>
                            <li><a href="#privacy" class="text-white/80 hover:text-white transition-colors duration-200">Privacy Policy</a></li>
                        </ul>
                    </div> -->
                    
                    <!-- Contact Info -->
                    <div>
                        <!-- <h3 class="text-lg font-semibold text-white mb-4">Contact Info</h3>
                        <div class="space-y-3">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-phone text-white/60"></i>
                                <span class="text-white/80">0800 123 456</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-envelope text-white/60"></i>
                                <span class="text-white/80">info@roadside.com</span>
                            </div> -->
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-map-marker-alt text-white/60"></i>
                                <span class="text-white/80">Agadir, Morocco</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-clock text-white/60"></i>
                                <span class="text-white/80">24/7 Service</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Footer -->
                <div class="border-t border-white/20 mt-6 pt-6 flex flex-col md:flex-row justify-between items-center">
                    <p class="text-white/60 text-sm">
                        © 2025 Hamza Assitance. All rights reserved.
                    </p>
                    <!-- <div class="flex space-x-6 mt-4 md:mt-0">
                        <a href="#terms" class="text-white/60 hover:text-white text-sm transition-colors duration-200">Terms of Service</a>
                        <a href="#privacy" class="text-white/60 hover:text-white text-sm transition-colors duration-200">Privacy Policy</a>
                        <a href="#cookies" class="text-white/60 hover:text-white text-sm transition-colors duration-200">Cookie Policy</a>
                    </div> -->
                </div>
            </div>
        </footer>
        
        <!-- Modal for success message -->
        <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="glass-effect rounded-lg p-8 text-center shadow-2xl transform transition-all max-w-sm w-full">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-500 mb-4">
                    <i class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 class="text-lg leading-6 font-medium text-white">Request Sent!</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-white/80">
                        We've received your request. An administrator will review it shortly.
                    </p>
                </div>
                <div class="mt-4">
                    <button id="close-modal-btn" type="button" class="w-full bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white font-bold py-2 px-4 rounded-lg">
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- CRUD Success Modal -->
        <div id="crud-success-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="glass-effect rounded-lg p-8 text-center shadow-2xl transform transition-all max-w-sm w-full">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-500 mb-4">
                    <i class="fas fa-check text-white text-2xl"></i>
                </div>
                <h3 id="crud-success-title" class="text-lg leading-6 font-medium text-white">Success!</h3>
                <div class="mt-2 px-7 py-3">
                    <p id="crud-success-message" class="text-sm text-white/80">
                        Operation completed successfully.
                    </p>
                </div>
                <div class="mt-4">
                    <button id="close-crud-success-modal" type="button" class="w-full bg-gradient-to-r from-blue-600 to-blue-800 hover:from-blue-700 hover:to-blue-900 text-white font-bold py-2 px-4 rounded-lg">
                        OK
                    </button>
                </div>
            </div>
        </div>

        <!-- CRUD Modal -->
        <div id="crud-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl mx-auto glass-effect rounded-lg p-4 sm:p-6 md:p-8 shadow-2xl transform transition-all mx-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="crud-modal-title" class="text-lg font-bold text-white">Add New Item</h3>
                    <button id="close-crud-modal" class="text-white/60 hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form id="crud-form" class="space-y-4">
                    <div id="contact-fields" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Name</label>
                            <input type="text" id="contact-name" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Phone</label>
                            <input type="tel" id="contact-phone" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Email</label>
                            <input type="email" id="contact-email" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <!-- Role selection removed as requested -->
                        </div>
                    </div>
                    <div id="user-fields" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Username</label>
                            <input type="text" id="user-username" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Email</label>
                            <input type="email" id="user-email" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <!-- Role selection removed as requested -->
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Status</label>
                            <select id="user-status" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </div>
                    <div id="admin-fields" class="space-y-4 hidden">
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Admin Name</label>
                            <input type="text" id="admin-name" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Username</label>
                            <input type="text" id="admin-username" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Email</label>
                            <input type="email" id="admin-email" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Phone</label>
                            <input type="tel" id="admin-phone" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Admin Level</label>
                            <select id="admin-level" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                                <option value="admin">Admin</option>
                                <option value="super_admin">Super Admin</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-white/90 mb-1">Status</label>
                            <select id="admin-status" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" id="crud-save-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">
                            Save
                        </button>
                        <button type="button" id="crud-cancel-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Assignment Modal -->
        <div id="assignment-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
            <div class="glass-effect rounded-lg p-6 shadow-2xl transform transition-all max-w-md w-full mx-4">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-white">Assign User to Contact</h3>
                    <button id="close-assignment-modal" class="text-white/60 hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form id="assignment-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-white/90 mb-1">Select Contact</label>
                        <select id="assignment-contact" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                            <option value="">Choose a contact...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white/90 mb-1">Select User</label>
                        <select id="assignment-user" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                            <option value="">Choose a user...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white/90 mb-1">Status</label>
                        <select id="assignment-status" class="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-white/50">
                            <option value="assigned">Assigned</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">
                            Assign
                        </button>
                        <button type="button" id="assignment-cancel-btn" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <script>
        // API Base URL
        const API_BASE_URL = 'http://localhost:3000/api';
        
        // Global data storage
        let requests = [];
        let contacts = [];
        let users = [];
        let assignments = [];

        document.addEventListener('DOMContentLoaded', function() {
            const userViewBtn = document.getElementById('user-view-btn');
            const adminViewBtn = document.getElementById('admin-view-btn');
            const superAdminBtn = document.getElementById('super-admin-btn');
            const userView = document.getElementById('user-view');
            const adminView = document.getElementById('admin-view');
            const superAdminView = document.getElementById('super-admin-view');
            const requestForm = document.getElementById('request-form');
            const adminRequestList = document.getElementById('admin-request-list');
            const successModal = document.getElementById('success-modal');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const photoUpload = document.getElementById('photo-upload');
            const fileNameDisplay = document.getElementById('file-name');

            // ...existing code...

            // API Helper Functions
            async function apiCall(endpoint, options = {}) {
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        },
                        ...options
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API call failed:', error);
                    throw error;
                }
            }

            async function loadData() {
                try {
                    // Load all data in parallel
                    const [requestsData, contactsData, usersData, assignmentsData, adminsData] = await Promise.all([
                        apiCall('/requests'),
                        apiCall('/contacts'),
                        apiCall('/users'),
                        apiCall('/assignments'),
                        apiCall('/admins')
                    ]);
                    
                    requests = requestsData;
                    contacts = contactsData;
                    users = usersData;
                    assignments = assignmentsData;
                    admins = adminsData;
                    
                    console.log('Data loaded successfully');
                } catch (error) {
                    console.error('Failed to load data:', error);
                    // Fallback to mock data if API is not available
                    requests = [
                        { id: 1, userInfo: 'Full Name: Alice Martin\nCar Model: Renault Clio\nPhone: 0611223344\nLocation: Rabat, Morocco', imageUrl: 'https://placehold.co/600x400/334155/ffffff?text=Broken+Down+Clio', status: 'Submitted' },
                        { id: 2, userInfo: 'Full Name: Bob Dubois\nCar Model: Dacia Duster\nPhone: 0655667788\nLocation: Marrakech, Morocco', imageUrl: 'https://placehold.co/600x400/334155/ffffff?text=Flat+Tire+Duster', status: 'Submitted' },
                        { id: 3, userInfo: 'Full Name: Charlie Petit\nCar Model: Ford Focus\nPhone: 0699887766\nLocation: Tangier, Morocco', imageUrl: 'https://placehold.co/600x400/334155/ffffff?text=Engine+Smoke', status: 'In Progress' }
                    ];
                    contacts = [
                        { id: 1, name: 'Ahmed Mechanic', phone: '0612345678', email: 'ahmed@roadside.com', role: 'mechanic' },
                        { id: 2, name: 'Fatima Towing', phone: '0623456789', email: 'fatima@roadside.com', role: 'towing' },
                        { id: 3, name: 'Karim Emergency', phone: '0634567890', email: 'karim@roadside.com', role: 'emergency' }
                    ];
                    users = [
                        { id: 1, username: 'admin1', email: 'admin1@roadside.com', role: 'admin', status: 'active' },
                        { id: 2, username: 'superadmin', email: 'super@roadside.com', role: 'super_admin', status: 'active' },
                        { id: 3, username: 'operator1', email: 'op1@roadside.com', role: 'operator', status: 'active' }
                    ];
                    admins = [
                        { id: 1, name: 'John Admin', username: 'admin1', email: 'admin1@roadside.com', phone: '0612345678', level: 'admin', status: 'active' },
                        { id: 2, name: 'Sarah Super', username: 'superadmin', email: 'super@roadside.com', phone: '0623456789', level: 'super_admin', status: 'active' }
                    ];
                    assignments = [
                        { id: 1, contactId: 1, userId: 1, status: 'assigned', requestId: 1 },
                        { id: 2, contactId: 2, userId: 3, status: 'in_progress', requestId: 2 }
                    ];
                }
            }

            function renderAdminRequests() {
                adminRequestList.innerHTML = ''; // Clear existing content
                if (requests.length === 0) {
                    adminRequestList.innerHTML = `<div class="text-center text-white/60 col-span-full py-10"><i class="fas fa-inbox text-3xl"></i><p class="mt-2">No active requests.</p></div>`;
                    return;
                }
                
                requests.forEach(req => {
                    const card = document.createElement('div');
                    card.className = 'glass-effect rounded-xl shadow-lg p-5 flex flex-col card-enter';
                    const statusColor = req.status === 'Submitted' ? 'bg-orange-500' : 'bg-blue-500';
                    const statusText = req.status === 'Submitted' ? 'New Request' : 'In Progress';
                    const imageUrl = req.imageUrl ? `http://localhost:3000${req.imageUrl}` : 'https://placehold.co/600x400/1a202c/ffffff?text=No+Image';

                    card.innerHTML = `
                        <div class="relative">
                            <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1a202c/ffffff?text=Image+Not+Found';" alt="Car problem" class="rounded-lg w-full h-40 object-cover mb-4">
                            <span class="absolute top-2 right-2 ${statusColor} text-white text-xs font-bold px-2 py-1 rounded-full">${statusText}</span>
                        </div>
                        <div class="mb-4">
                            <pre class="text-white/90 text-sm whitespace-pre-wrap">${req.userInfo}</pre>
                            ${req.contactName ? `
                                <div class="mt-3 p-3 bg-white/10 rounded-lg">
                                    <p class="text-white/80 text-sm"><strong>Assigned:</strong> ${req.contactName} (${req.contactRole})</p>
                                    <p class="text-white/80 text-sm"><strong>User:</strong> ${req.userName}</p>
                                </div>
                            ` : ''}
                        </div>
                        <div class="mt-auto pt-4 border-t border-white/20 flex justify-between gap-2">
                            <button onclick="markRequestResolved(${req.id})" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition">Mark Resolved</button>
                            <button onclick="openAssignmentModal(${req.id})" class="flex-1 bg-white/20 hover:bg-white/30 text-white font-semibold py-2 px-3 rounded-lg text-sm transition">${req.contactName ? 'Reassign' : 'Assign'}</button>
                        </div>
                    `;
                    adminRequestList.appendChild(card);
                });
            }

            // View toggling logic
            userViewBtn.addEventListener('click', () => {
                userView.classList.remove('hidden');
                adminView.classList.add('hidden');
                superAdminView.classList.add('hidden');
                userViewBtn.classList.add('active');
                adminViewBtn.classList.remove('active');
                superAdminBtn.classList.remove('active');
            });

            adminViewBtn.addEventListener('click', () => {
                adminView.classList.remove('hidden');
                userView.classList.add('hidden');
                superAdminView.classList.add('hidden');
                adminViewBtn.classList.add('active');
                userViewBtn.classList.remove('active');
                superAdminBtn.classList.remove('active');
                renderAdminRequests();
            });

            superAdminBtn.addEventListener('click', () => {
                superAdminView.classList.remove('hidden');
                userView.classList.add('hidden');
                adminView.classList.add('hidden');
                superAdminBtn.classList.add('active');
                userViewBtn.classList.remove('active');
                adminViewBtn.classList.remove('active');
                // Initial content for super admin view - show Operators tab by default
                setActiveTab('contacts');
            });
            
            // Form submission logic
            requestForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData();
                formData.append('userInfo', document.getElementById('userInfo').value);
                
                if (photoUpload.files.length > 0) {
                    formData.append('photo', photoUpload.files[0]);
                }
                
                try {
                    const response = await fetch(`${API_BASE_URL}/requests`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log('Request submitted successfully:', result);
                    
                    // Reload data to show the new request
                    await loadData();
                    
                    successModal.classList.remove('hidden');
                    requestForm.reset();
                    fileNameDisplay.textContent = 'PNG, JPG, GIF up to 10MB';
                } catch (error) {
                    console.error('Failed to submit request:', error);
                    alert('Failed to submit request. Please try again.');
                }
            });

            // Modal closing logic
            closeModalBtn.addEventListener('click', () => {
                successModal.classList.add('hidden');
            });

            // CRUD Success Modal elements
            const crudSuccessModal = document.getElementById('crud-success-modal');
            const closeCrudSuccessModal = document.getElementById('close-crud-success-modal');
            const crudSuccessTitle = document.getElementById('crud-success-title');
            const crudSuccessMessage = document.getElementById('crud-success-message');

            // CRUD Success Modal closing logic
            closeCrudSuccessModal.addEventListener('click', () => {
                crudSuccessModal.classList.add('hidden');
            });

            // Close CRUD success modal when clicking outside
            crudSuccessModal.addEventListener('click', (e) => {
                if (e.target === crudSuccessModal) {
                    crudSuccessModal.classList.add('hidden');
                }
            });

            // Function to show CRUD success message
            function showCrudSuccess(title, message) {
                crudSuccessTitle.textContent = title;
                crudSuccessMessage.textContent = message;
                crudSuccessModal.classList.remove('hidden');
            }
            
            // File upload display name
            photoUpload.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    fileNameDisplay.textContent = this.files[0].name;
                } else {
                    fileNameDisplay.textContent = 'PNG, JPG, GIF up to 10MB';
                }
            });

            // Super Admin CRUD functionality
            const crudModal = document.getElementById('crud-modal');
            const closeCrudModal = document.getElementById('close-crud-modal');
            const crudCancelBtn = document.getElementById('crud-cancel-btn');
            const crudForm = document.getElementById('crud-form');
            const crudModalTitle = document.getElementById('crud-modal-title');
            const crudSaveBtn = document.getElementById('crud-save-btn');
            
            // Assignment modal elements
            const assignmentModal = document.getElementById('assignment-modal');
            const closeAssignmentModal = document.getElementById('close-assignment-modal');
            const assignmentCancelBtn = document.getElementById('assignment-cancel-btn');
            const assignmentForm = document.getElementById('assignment-form');
            
            // Tab elements
            const contactsTab = document.getElementById('contacts-tab');
            // const usersTab = document.getElementById('users-tab');
            const requestsTab = document.getElementById('requests-tab');
            const adminTab = document.getElementById('admin-tab');
            const contactsSection = document.getElementById('contacts-section');
            // const usersSection = document.getElementById('users-section');
            const requestsSection = document.getElementById('requests-section');
            const adminSection = document.getElementById('admin-section');
            
            // Admin tab elements
            const adminRequestsTab = document.getElementById('admin-requests-tab');
            const adminContactsTab = document.getElementById('admin-contacts-tab');
            const adminRequestsSection = document.getElementById('admin-requests-section');
            const adminContactsSection = document.getElementById('admin-contacts-section');
            
            // CRUD buttons
            const addContactBtn = document.getElementById('add-contact-btn');
            // const addUserBtn = document.getElementById('add-user-btn');
            const addAdminBtn = document.getElementById('add-admin-btn');
            const adminAddContactBtn = document.getElementById('admin-add-contact-btn');
            
            // Mock data for Super Admin
            let contacts = [
                { id: 1, name: 'Ahmed Mechanic', phone: '0612345678', email: 'ahmed@roadside.com', role: 'mechanic' },
                { id: 2, name: 'Fatima Towing', phone: '0623456789', email: 'fatima@roadside.com', role: 'towing' },
                { id: 3, name: 'Karim Emergency', phone: '0634567890', email: 'karim@roadside.com', role: 'emergency' }
            ];
            
            let users = [
                { id: 1, username: 'admin1', email: 'admin1@roadside.com', role: 'admin', status: 'active' },
                { id: 2, username: 'superadmin', email: 'super@roadside.com', role: 'super_admin', status: 'active' },
                { id: 3, username: 'operator1', email: 'op1@roadside.com', role: 'operator', status: 'active' }
            ];
            
            let admins = [
                { id: 1, name: 'John Admin', username: 'admin1', email: 'admin1@roadside.com', phone: '0612345678', level: 'admin', status: 'active' },
                { id: 2, name: 'Sarah Super', username: 'superadmin', email: 'super@roadside.com', phone: '0623456789', level: 'super_admin', status: 'active' }
            ];

            // Assignment data
            let assignments = [
                { id: 1, contactId: 1, userId: 1, status: 'assigned', requestId: 1 },
                { id: 2, contactId: 2, userId: 3, status: 'in_progress', requestId: 2 }
            ];
            
            let currentEditId = null;
            let currentEditType = null;

            // Admin tab switching functionality
            adminRequestsTab.addEventListener('click', () => {
                setAdminActiveTab('requests');
                renderAdminRequests();
            });
            
            adminContactsTab.addEventListener('click', () => {
                setAdminActiveTab('contacts');
                renderAdminContacts();
            });

            function setAdminActiveTab(activeTab) {
                // Reset all admin tabs
                [adminRequestsTab, adminContactsTab].forEach(tab => tab.classList.remove('bg-white/30'));
                [adminRequestsSection, adminContactsSection].forEach(section => section.classList.add('hidden'));
                
                // Set active admin tab
                switch(activeTab) {
                    case 'requests':
                        adminRequestsTab.classList.add('bg-white/30');
                        adminRequestsSection.classList.remove('hidden');
                        break;
                    case 'contacts':
                        adminContactsTab.classList.add('bg-white/30');
                        adminContactsSection.classList.remove('hidden');
                        break;
                }
            }

            // Tab switching functionality
            contactsTab.addEventListener('click', () => {
                setActiveTab('contacts');
                renderContacts();
            });
            
            // usersTab.addEventListener('click', () => {
            //     setActiveTab('users');
            //     renderUsers();
            // });
            
            requestsTab.addEventListener('click', () => {
                setActiveTab('requests');
                renderSuperAdminRequests();
            });
            
            adminTab.addEventListener('click', () => {
                setActiveTab('admin');
                renderAdmins();
            });

            function setActiveTab(activeTab) {
                console.log('Setting active tab:', activeTab);
                
                // Reset all tabs
                [contactsTab, requestsTab, adminTab].forEach(tab => tab.classList.remove('bg-white/30'));
                [contactsSection, requestsSection, adminSection].forEach(section => {
                    section.classList.add('hidden');
                    section.style.display = 'none';
                    console.log('Hiding section:', section.id);
                });
                
                // Set active tab
                switch(activeTab) {
                    case 'contacts':
                        contactsTab.classList.add('bg-white/30');
                        contactsSection.classList.remove('hidden');
                        contactsSection.style.display = 'block';
                        console.log('Showing contacts section');
                        break;
                    case 'requests':
                        requestsTab.classList.add('bg-white/30');
                        requestsSection.classList.remove('hidden');
                        requestsSection.style.display = 'block';
                        console.log('Showing requests section');
                        break;
                    case 'admin':
                        adminTab.classList.add('bg-white/30');
                        adminSection.classList.remove('hidden');
                        adminSection.style.display = 'block';
                        console.log('Showing admin section');
                        break;
                }
            }

            // Render functions
            function renderContacts() {
                const contactsList = document.getElementById('contacts-list');
                contactsList.innerHTML = '';
                
                contacts.forEach(contact => {
                    const contactCard = document.createElement('div');
                    contactCard.className = 'glass-effect p-4 rounded-lg flex justify-between items-center';
                    contactCard.innerHTML = `
                        <div>
                            <h4 class="font-bold text-white">${contact.name}</h4>
                            <p class="text-white/80 text-sm">${contact.phone} • ${contact.email}</p>
                            <span class="inline-block bg-blue-500 text-white text-xs px-2 py-1 rounded-full mt-1">${contact.role}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editItem('contact', ${contact.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteItem('contact', ${contact.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    contactsList.appendChild(contactCard);
                });
            }

            function renderAdminContacts() {
                const adminContactsList = document.getElementById('admin-contacts-list');
                adminContactsList.innerHTML = '';
                
                contacts.forEach(contact => {
                    const contactCard = document.createElement('div');
                    contactCard.className = 'glass-effect p-4 rounded-lg flex justify-between items-center';
                    contactCard.innerHTML = `
                        <div>
                            <h4 class="font-bold text-white">${contact.name}</h4>
                            <p class="text-white/80 text-sm">${contact.phone} • ${contact.email}</p>
                            <span class="inline-block bg-blue-500 text-white text-xs px-2 py-1 rounded-full mt-1">${contact.role}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editItem('contact', ${contact.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteItem('contact', ${contact.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    adminContactsList.appendChild(contactCard);
                });
            }

            function renderUsers() {
                const usersList = document.getElementById('users-list');
                usersList.innerHTML = '';
                
                users.forEach(user => {
                    const userCard = document.createElement('div');
                    userCard.className = 'glass-effect p-4 rounded-lg flex justify-between items-center';
                    const statusColor = user.status === 'active' ? 'bg-green-500' : user.status === 'inactive' ? 'bg-gray-500' : 'bg-red-500';
                    userCard.innerHTML = `
                        <div>
                            <h4 class="font-bold text-white">${user.username}</h4>
                            <p class="text-white/80 text-sm">${user.email}</p>
                            <div class="flex gap-2 mt-1">
                                <span class="inline-block bg-blue-500 text-white text-xs px-2 py-1 rounded-full">${user.role}</span>
                                <span class="inline-block ${statusColor} text-white text-xs px-2 py-1 rounded-full">${user.status}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editItem('user', ${user.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteItem('user', ${user.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    usersList.appendChild(userCard);
                });
            }

            function renderAdmins() {
                const adminList = document.getElementById('admin-list');
                adminList.innerHTML = '';
                
                admins.forEach(admin => {
                    const adminCard = document.createElement('div');
                    adminCard.className = 'glass-effect p-4 rounded-lg flex justify-between items-center';
                    const statusColor = admin.status === 'active' ? 'bg-green-500' : admin.status === 'inactive' ? 'bg-gray-500' : 'bg-red-500';
                    const levelColor = admin.level === 'super_admin' ? 'bg-purple-500' : 'bg-blue-500';
                    adminCard.innerHTML = `
                        <div>
                            <h4 class="font-bold text-white">${admin.name}</h4>
                            <p class="text-white/80 text-sm">${admin.username} • ${admin.email}</p>
                            <p class="text-white/80 text-sm">${admin.phone}</p>
                            <div class="flex gap-2 mt-1">
                                <span class="inline-block ${levelColor} text-white text-xs px-2 py-1 rounded-full">${admin.level.replace('_', ' ')}</span>
                                <span class="inline-block ${statusColor} text-white text-xs px-2 py-1 rounded-full">${admin.status}</span>
                            </div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editItem('admin', ${admin.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteItem('admin', ${admin.id})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    adminList.appendChild(adminCard);
                });
            }

            function renderSuperAdminRequests() {
                const superAdminRequests = document.getElementById('super-admin-requests');
                superAdminRequests.innerHTML = '';
                
                requests.forEach(req => {
                    const assignment = assignments.find(a => a.requestId === req.id);
                    const assignedContact = assignment ? contacts.find(c => c.id === assignment.contactId) : null;
                    const assignedUser = assignment ? users.find(u => u.id === assignment.userId) : null;
                    
                    const card = document.createElement('div');
                    card.className = 'glass-effect rounded-xl shadow-lg p-5 flex flex-col card-enter';
                    const statusColor = req.status === 'Submitted' ? 'bg-orange-500' : 'bg-blue-500';
                    const statusText = req.status === 'Submitted' ? 'New Request' : 'In Progress';
                    const imageUrl = req.imageUrl ? `http://localhost:3000${req.imageUrl}` : 'https://placehold.co/600x400/1a202c/ffffff?text=No+Image';

                    card.innerHTML = `
                        <div class="relative">
                            <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1a202c/ffffff?text=Image+Not+Found';" alt="Car problem" class="rounded-lg w-full h-40 object-cover mb-4">
                            <span class="absolute top-2 right-2 ${statusColor} text-white text-xs font-bold px-2 py-1 rounded-full">${statusText}</span>
                        </div>
                        <div class="mb-4">
                            <pre class="text-white/90 text-sm whitespace-pre-wrap">${req.userInfo}</pre>
                            ${assignment ? `
                                <div class="mt-3 p-3 bg-white/10 rounded-lg">
                                    <p class="text-white/80 text-sm"><strong>Assigned:</strong> ${assignedContact?.name} (${assignedContact?.role})</p>
                                    <p class="text-white/80 text-sm"><strong>User:</strong> ${assignedUser?.username}</p>
                                    <p class="text-white/80 text-sm"><strong>Status:</strong> <span class="capitalize">${assignment.status.replace('_', ' ')}</span></p>
                                </div>
                            ` : ''}
                        </div>
                        <div class="mt-auto pt-4 border-t border-white/20 flex justify-between gap-2">
                            <button onclick="openAssignmentModal(${req.id})" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition">${assignment ? 'Reassign' : 'Assign'}</button>
                            <button onclick="deleteRequest(${req.id})" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition">Delete</button>
                        </div>
                    `;
                    superAdminRequests.appendChild(card);
                });
            }

            // Assignment Modal functionality
            function openAssignmentModal(requestId) {
                const assignmentContactSelect = document.getElementById('assignment-contact');
                const assignmentUserSelect = document.getElementById('assignment-user');
                
                // Populate contact dropdown
                assignmentContactSelect.innerHTML = '<option value="">Choose a contact...</option>';
                contacts.forEach(contact => {
                    assignmentContactSelect.innerHTML += `<option value="${contact.id}">${contact.name} (${contact.role})</option>`;
                });
                
                // Populate user dropdown
                assignmentUserSelect.innerHTML = '<option value="">Choose a user...</option>';
                users.forEach(user => {
                    assignmentUserSelect.innerHTML += `<option value="${user.id}">${user.username} (${user.role})</option>`;
                });
                
                // Set request ID for assignment
                assignmentForm.dataset.requestId = requestId;
                
                assignmentModal.classList.remove('hidden');
            }

            // Close assignment modal functions
            closeAssignmentModal.addEventListener('click', closeAssignmentModalFunc);
            assignmentCancelBtn.addEventListener('click', closeAssignmentModalFunc);

            function closeAssignmentModalFunc() {
                assignmentModal.classList.add('hidden');
                assignmentForm.reset();
            }

            // Assignment form submission
            assignmentForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const requestId = parseInt(this.dataset.requestId);
                const contactId = parseInt(document.getElementById('assignment-contact').value);
                const userId = parseInt(document.getElementById('assignment-user').value);
                const status = document.getElementById('assignment-status').value;
                
                if (!contactId || !userId) {
                    alert('Please select both a contact and a user.');
                    return;
                }
                
                try {
                    await apiCall('/assignments', {
                        method: 'POST',
                        body: JSON.stringify({
                            requestId,
                            contactId,
                            userId,
                            status
                        })
                    });
                    
                    await loadData();
                    closeAssignmentModalFunc();
                    renderSuperAdminRequests();
                    renderAdminRequests();
                    showCrudSuccess('Assignment Created!', 'Request has been assigned successfully.');
                } catch (error) {
                    console.error('Failed to create assignment:', error);
                    alert('Failed to create assignment. Please try again.');
                }
            });

            // CRUD Modal functionality
            addContactBtn.addEventListener('click', () => openCrudModal('contact', 'add'));
            // addUserBtn.addEventListener('click', () => openCrudModal('user', 'add'));
            addAdminBtn.addEventListener('click', () => openCrudModal('admin', 'add'));
            adminAddContactBtn.addEventListener('click', () => openCrudModal('contact', 'add'));

            function openCrudModal(type, action, id = null) {
                currentEditType = type;
                currentEditId = id;
                
                // Show/hide appropriate fields
                document.getElementById('contact-fields').classList.toggle('hidden', type !== 'contact');
                document.getElementById('user-fields').classList.toggle('hidden', type !== 'user');
                document.getElementById('admin-fields').classList.toggle('hidden', type !== 'admin');
                
                // Set modal title
                const actionText = action === 'add' ? 'Add New' : 'Edit';
                const typeText = type === 'contact' ? 'Contact' : type === 'user' ? 'User' : 'Admin';
                crudModalTitle.textContent = `${actionText} ${typeText}`;
                
                // Clear form
                crudForm.reset();
                
                // If editing, populate form
                if (action === 'edit' && id) {
                    let item;
                    if (type === 'contact') {
                        item = contacts.find(c => c.id === id);
                    } else if (type === 'user') {
                        item = users.find(u => u.id === id);
                    } else if (type === 'admin') {
                        item = admins.find(a => a.id === id);
                    }
                    
                    if (item) {
                        if (type === 'contact') {
                            document.getElementById('contact-name').value = item.name;
                            document.getElementById('contact-phone').value = item.phone;
                            document.getElementById('contact-email').value = item.email;
                            document.getElementById('contact-role').value = item.role;
                        } else if (type === 'user') {
                            document.getElementById('user-username').value = item.username;
                            document.getElementById('user-email').value = item.email;
                            document.getElementById('user-role').value = item.role;
                            document.getElementById('user-status').value = item.status;
                        } else if (type === 'admin') {
                            document.getElementById('admin-name').value = item.name;
                            document.getElementById('admin-username').value = item.username;
                            document.getElementById('admin-email').value = item.email;
                            document.getElementById('admin-phone').value = item.phone;
                            document.getElementById('admin-level').value = item.level;
                            document.getElementById('admin-status').value = item.status;
                        }
                    }
                }
                
                crudModal.classList.remove('hidden');
            }

            // Close modal functions
            closeCrudModal.addEventListener('click', closeCrudModalFunc);
            crudCancelBtn.addEventListener('click', closeCrudModalFunc);

            function closeCrudModalFunc() {
                crudModal.classList.add('hidden');
                currentEditId = null;
                currentEditType = null;
            }

            // Form submission
            crudForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                try {
                    if (currentEditType === 'contact') {
                        const contactData = {
                            name: document.getElementById('contact-name').value,
                            phone: document.getElementById('contact-phone').value,
                            email: document.getElementById('contact-email').value,
                            role: document.getElementById('contact-role').value
                        };
                        
                        if (currentEditId) {
                            // Update existing contact
                            await apiCall(`/contacts/${currentEditId}`, {
                                method: 'PUT',
                                body: JSON.stringify(contactData)
                            });
                        } else {
                            // Add new contact
                            await apiCall('/contacts', {
                                method: 'POST',
                                body: JSON.stringify(contactData)
                            });
                        }
                        await loadData();
                        renderContacts();
                        renderAdminContacts();
                    } else if (currentEditType === 'user') {
                        const userData = {
                            username: document.getElementById('user-username').value,
                            email: document.getElementById('user-email').value,
                            role: document.getElementById('user-role').value,
                            status: document.getElementById('user-status').value
                        };
                        
                        if (currentEditId) {
                            // Update existing user
                            await apiCall(`/users/${currentEditId}`, {
                                method: 'PUT',
                                body: JSON.stringify(userData)
                            });
                        } else {
                            // Add new user
                            await apiCall('/users', {
                                method: 'POST',
                                body: JSON.stringify(userData)
                            });
                        }
                        await loadData();
                        renderUsers();
                    } else if (currentEditType === 'admin') {
                        const adminData = {
                            name: document.getElementById('admin-name').value,
                            username: document.getElementById('admin-username').value,
                            email: document.getElementById('admin-email').value,
                            phone: document.getElementById('admin-phone').value,
                            level: document.getElementById('admin-level').value,
                            status: document.getElementById('admin-status').value
                        };
                        
                        if (currentEditId) {
                            // Update existing admin
                            await apiCall(`/admins/${currentEditId}`, {
                                method: 'PUT',
                                body: JSON.stringify(adminData)
                            });
                        } else {
                            // Add new admin
                            await apiCall('/admins', {
                                method: 'POST',
                                body: JSON.stringify(adminData)
                            });
                        }
                        await loadData();
                        renderAdmins();
                    }
                    
                    // Show success message based on operation type
                    const actionText = currentEditId ? 'Updated' : 'Added';
                    const typeText = currentEditType === 'contact' ? 'Operator' : currentEditType === 'user' ? 'User' : 'Admin';
                    showCrudSuccess(`${actionText} Successfully!`, `${typeText} has been ${actionText.toLowerCase()} successfully.`);
                    
                    closeCrudModalFunc();
                } catch (error) {
                    console.error('Failed to save item:', error);
                    alert('Failed to save item. Please try again.');
                }
            });

            // Global functions for edit and delete
            window.editItem = function(type, id) {
                openCrudModal(type, 'edit', id);
            };

            window.deleteItem = async function(type, id) {
                if (confirm('Are you sure you want to delete this item?')) {
                    try {
                        if (type === 'contact') {
                            await apiCall(`/contacts/${id}`, { method: 'DELETE' });
                            await loadData();
                            renderContacts();
                            renderAdminContacts();
                            showCrudSuccess('Deleted Successfully!', 'Operator has been deleted successfully.');
                        } else if (type === 'user') {
                            await apiCall(`/users/${id}`, { method: 'DELETE' });
                            await loadData();
                            renderUsers();
                            showCrudSuccess('Deleted Successfully!', 'User has been deleted successfully.');
                        } else if (type === 'admin') {
                            await apiCall(`/admins/${id}`, { method: 'DELETE' });
                            await loadData();
                            renderAdmins();
                            showCrudSuccess('Deleted Successfully!', 'Admin has been deleted successfully.');
                        }
                    } catch (error) {
                        console.error('Failed to delete item:', error);
                        alert('Failed to delete item. Please try again.');
                    }
                }
            };

            // Global function for assignment modal
            window.openAssignmentModal = function(requestId) {
                openAssignmentModal(requestId);
            };

            // Global function for marking request as resolved
            window.markRequestResolved = async function(requestId) {
                try {
                    await apiCall(`/requests/${requestId}/status`, {
                        method: 'PUT',
                        body: JSON.stringify({ status: 'Completed' })
                    });
                    await loadData();
                    renderAdminRequests();
                    renderSuperAdminRequests();
                    showCrudSuccess('Request Completed!', 'Request has been marked as resolved successfully.');
                } catch (error) {
                    console.error('Failed to mark request as resolved:', error);
                    alert('Failed to mark request as resolved. Please try again.');
                }
            };

            // Global function for deleting request
            window.deleteRequest = async function(requestId) {
                if (confirm('Are you sure you want to delete this request?')) {
                    try {
                        await apiCall(`/requests/${requestId}`, { method: 'DELETE' });
                        await loadData();
                        renderSuperAdminRequests();
                        renderAdminRequests();
                        showCrudSuccess('Request Deleted!', 'Request has been deleted successfully.');
                    } catch (error) {
                        console.error('Failed to delete request:', error);
                        alert('Failed to delete request. Please try again.');
                    }
                }
            };

            // Initialize data and views
            loadData().then(() => {
                renderContacts();
                // renderUsers();
                renderAdmins();
                renderSuperAdminRequests();
                renderAdminContacts();
            });

        });
    </script>
</body>
</html>
